<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<style>
  .wrapper {
    float: left;
    margin-left: 50px;
  }
</style>
<body>
<div style="position: fixed;right: 0;" id='state'></div>

<div>
  <input id='normal' type='checkbox' checked onchange="change('normal')">normal</input>
  <input id='batch' type='checkbox' onchange="change('batch')">batch</input>
</div>
<div>
  <label>Performance:</label>
  <input value='2' oninput="change(this.value)"></input>
</div>
<div>
  <button id='add'>add</button>
  <button id='button'>run</button>
</div>

<div class='wrapper'>
  <div>high priority</div>
  <div class='container' id='container1'></div>
</div>
<div class='wrapper'>
  <div>middle priority</div>
  <div class='container' id='container2'></div>
</div>
<div class='wrapper'>
  <div>low priority</div>
  <div class='container' id='container3'></div>
</div>
<div class='wrapper'>
  <div>low priority</div>
  <div class='container' id='container4'></div>
</div>
<div class='wrapper'>
  <div>low priority</div>
  <div class='container' id='container5'></div>
</div>

<script src='../build/leopard.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/stats.js/r16/Stats.min.js'></script>
<script>
  var stats = new Stats();
  var xPanel = stats.addPanel( new Stats.Panel( 'avg. count', '#ff8', '#221' ) );
  stats.showPanel( 3 );
  console.log(stats);
  document.querySelector('#state').appendChild( stats.domElement );
  var container1 = document.getElementById('container1');
  var container2 = document.getElementById('container2');
  var container3 = document.getElementById('container3');
  var c = 1
  var sum = 0
  function animate() {
      stats.begin();
      // monitored code goes here
      stats.end();
      sum += Leopard.limit
      c ++
      xPanel.update( Leopard.limit, 1000000 );
      requestAnimationFrame( animate );
  }
  requestAnimationFrame( animate );

  var actions = []
  var options = {
    strategy: 'normal',
    perf: 2
  }
  Leopard.start(options)

  function change(value) {
    if (value === 'batch') {
      options.strategy = value
      document.getElementById('normal').checked = false
    }
    else if (value === 'normal') {
      options.strategy = value
      document.getElementById('batch').checked = false
    }
    else if (value.length > 0 && !isNaN(value))
      options.perf = value
    Leopard.start(options)
  }

  var level = 0
  while(level ++ < 1000)
    add(Math.floor(level / 4))
  
  function add(l) {
      var div = document.createElement('div')
      var container
      if (l < 50)
        container = container1
      else if (l < 100)
        container = container2
      else if (l < 150)
        container = container3
      else if (l < 200)
        container = container4
      else if (l < 250)
        container = container5
      else
        return

      div.style.width = '100px'
      div.style.height = '5px'
      var color = l % 10
      div.style['background-color'] = '#' + color + '' + color + '' +  color
      container.appendChild(div)
      div.style.transform = 'translateX(' + Math.sin(l) * 1.5 + 'px)'
      var item = {
        distance: l + 1,
        div: div
      }
      actions.push(function() {
        Leopard.put(l, function () {
          var div = item.div
          var distance = item.distance
          item.distance ++
          div.style.transform = 'translateX(' + Math.sin(distance) * 1.5 + 'px)'
          // console.log(actions.length);
        })
      })
    }
  document.querySelector('#add').addEventListener('click', function(e) {
    level ++
    add(Math.floor(level / 2))
  });
  document.querySelector('#button').addEventListener('click', function(e) {
    actions.forEach(action => action())
    setInterval(function() {
      actions.forEach(action => action())
    }, 10)
    // Leopard.on(100, function() {
    //   actions.forEach(action => action())
    // })
    Leopard.start()
  });
</script>
</body>
</html>
