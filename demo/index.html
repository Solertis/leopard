<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
<div style="position: fixed;right: 0;" id='state'></div>

<div>
  <input id='script' type='checkbox' checked onchange="change('script')">Script heavy</input>
  <input id='style' type='checkbox' onchange="change('style')">Style heavy</input>
</div>
<div>
  <label>Performance:</label>
  <input value='2' oninput="change(this.value)"></input>
</div>
<div>
  <button id='add'>add</button>
  <button id='button'>run</button>
</div>

<script src='../build/leopard.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/stats.js/r16/Stats.min.js'></script>
<script>
  var stats = new Stats();
  var xPanel = stats.addPanel( new Stats.Panel( 'avg. count', '#ff8', '#221' ) );
  stats.showPanel( 3 );
  console.log(stats);
  document.querySelector('#state').appendChild( stats.domElement );

  var c = 1
  var sum = 0
  function animate() {
      stats.begin();
      // monitored code goes here
      stats.end();
      sum += Leopard.limit
      c ++
      xPanel.update( sum / c, 1000000 );
      requestAnimationFrame( animate );
  }
  requestAnimationFrame( animate );

  var actions = []
  var options = {
    strategy: 'style',
    perf: 2
  }
  Leopard.start(options)

  function change(value) {
    if (value === 'style') {
      options.strategy = value
      document.getElementById('script').checked = false
    }
    else if (value === 'script') {
      options.strategy = value
      document.getElementById('style').checked = false
    }
    else if (value.length > 0 && !isNaN(value))
      options.perf = value
    Leopard.start(options)
  }

  var level = 0
  while(level ++ < 50)
    add(level)
  
  function add(l) {
      var bag = []
      var container = document.createElement('div');
      document.body.appendChild(container)
      var times = 50
      while (times --) {
        var div = document.createElement('div')
        div.style.width = Math.random() * 20 + 'px'
        div.style.height = '10px'
        div.style['background-color'] =
          `#${Math.floor(Math.random() * 10)}${Math.floor(Math.random() * 10)}${Math.floor(Math.random() * 10)}`
        div.style.display = 'inline-block'
        container.appendChild(div)
        bag.push(div)
      }
      actions.push(function() {
        bag.filter(function() {
          return Math.random() > 0.5
        }).forEach(function(item) {
          var local = l
          Leopard.put(l, function () {
            container.appendChild(item)
          })
        })
      })
    }
  document.querySelector('#add').addEventListener('click', function(e) {
    add(level++)
  });
  document.querySelector('#button').addEventListener('click', function(e) {
    actions.forEach(action => action())
    setInterval(function() {
      actions.forEach(action => action())
    }, 16)
    Leopard.start()
  });
</script>
</body>
</html>
