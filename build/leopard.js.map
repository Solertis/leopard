{"version":3,"sources":["rAF.js","emitter.js","control.js","schedule.js","index.js"],"names":["queue","counter","emitter"],"mappings":"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","file":"leopard.js","sourcesContent":["// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik MÃ¶ller. fixes from Paul Irish and Tino Zijdel\n\n// MIT license\n\n(function() {\n  var lastTime = 0\n  var vendors = ['ms', 'moz', 'webkit', 'o']\n  for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\n    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame']\n    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||\n                                   window[vendors[x] + 'CancelRequestAnimationFrame']\n  }\n\n  if (!window.requestAnimationFrame)\n        window.requestAnimationFrame = function(callback, element) {\n          var currTime = new Date().getTime()\n          var timeToCall = Math.max(0, 16 - (currTime - lastTime))\n          var id = window.setTimeout(function() { callback(currTime + timeToCall); },\n              timeToCall)\n          lastTime = currTime + timeToCall\n          return id\n        }\n\n  if (!window.cancelAnimationFrame)\n        window.cancelAnimationFrame = function(id) {\n          clearTimeout(id)\n        }\n}())\n","var Emitter = function() {\n  this.uid = 0\n  this.handlers = []\n  // FIX 1000\n  for (let i = 0; i < 1000; i ++) this.handlers.push([])\n}\nEmitter.prototype.on = function(level, callback) {\n  this.handlers[level].push({\n    id: this.uid ++,\n    action: callback\n  })\n}\nEmitter.prototype.emit = function(level, ...args) {\n  this.handlers[level].forEach(handler => {\n    if (typeof(handler.action) === 'function')\n      handler.action(...args)\n  })\n}\nEmitter.prototype.once = function(level, callback) {\n  var id = this.uid\n  this.on(level, (...args) => {\n    callback(...args)\n    var handler = this.handlers[level].find(handler => handler.id === id)\n    this.handlers[level].splice(this.handlers[level].indexOf(handler), 1)\n    // delete handler\n  })\n}\nvar singletonEmitter = new Emitter()\nexport default singletonEmitter\n","import emitter from './emitter'\nvar queue = []\nvar counter = 0\nvar levels = 1000\n\nfor (let i = 0; i < levels; i ++) queue.push([])\n\nexport function run(count) {\n  for (var i = 0; i < queue.length; i ++) {\n    if (count < 1) break\n    var level = queue[i]\n    while (level.length) {\n      if (count < 1) break\n      counter --\n      // the bigger of level, the less emergent to complete\n      // So we deduce more for higher level (lower priority) actions\n      count = count - i * i\n      var callback = level.shift()\n      if (callback && typeof callback === 'function') callback()\n      if (!level.length) emitter.emit(i)\n    }\n    if (i === queue.length - 1 && counter === 0)\n      return false\n    return true\n  }\n}\n","import { run } from './control'\nvar perFrame = 16\nvar limit = 10\nvar balance = limit\nvar goal = perFrame\nvar isRunning = false\nvar accelerate = 1 // for slow start\n\nvar scriptStart\nvar scriptEnd\nvar styleStart\nvar styleEnd\n\nvar styleDuration\nvar scriptDuration\n\n\nfunction frame(frameStart) {\n  if (!isRunning) return\n\n  // calculate metrix\n  styleEnd = frameStart\n  styleDuration = styleStart ? (styleEnd - styleStart) : goal\n  scriptDuration = scriptEnd - scriptStart\n  scriptStart = now()\n  console.log(limit)\n  console.log(styleDuration);\n\n  // calculate limit\n  if (goal <= styleDuration && styleDuration < goal + 1 &&\n      styleDuration !== 0) {\n    accelerate = accelerate * 2\n    limit += accelerate\n  } else if (styleDuration >= goal + 1) {\n    accelerate = 1\n    limit = Math.floor(limit / 2)\n  } else if (styleDuration === 0) {\n    // This is a skipped frame\n  }\n  if (limit < 1)\n    limit = 1\n  if (!run(limit)) // stop\n    stop()\n  scriptEnd = now()\n  styleStart = frameStart\n  \n  requestAnimationFrame(frame)\n  if (window && window.requestIdleCallback) {\n    // For browsers which support requestIdleCallback\n    requestIdleCallback(function(deadline) {\n      if (deadline.timeRemaining() > 0) {\n        var ratio = deadline.timeRemaining() / perFrame\n        run(Math.floor(limit * ratio))\n      }\n    })\n  }\n}\n\n\nfunction now() {\n  return performance.now() || Date.now()\n}\n\nexport function stop() {\n  console.log('stop');\n  accelerate = 1 // for slow start\n  multiplier = 2\n  isRunning = false\n}\nexport function start() {\n  scriptStart = null\n  scriptEnd = null\n  styleStart = null\n  styleEnd = null\n  isRunning = true\n  requestAnimationFrame(frame)\n\n}\nexport function put(priority, callback, times) {\n  if (!times) {\n    queue[priority].push(callback)\n    counter ++\n  } else {\n    while (times--)  {\n      queue[priority].push(callback)\n      counter ++\n    }\n  }\n  if (!isRunning)\n    start()\n}\n","import _ from './rAF'\nimport {\n  start,\n  stop,\n  put\n} from './schedule'\nimport emitter from './emitter'\nvar Leopard = {\n  on: emitter.on.bind(emitter),\n  once: emitter.once.bind(emitter),\n  start,\n  stop,\n  put\n}\n\nif (typeof exports === 'object')\n    module.exports = Leopard\nelse if (typeof define === 'function' && typeof define.amd !== 'undefined')\n  define(function() { return Leopard })\nelse\n  window.Leopard = Leopard\n"],"sourceRoot":"/source/"}